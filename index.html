<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SEL Adventures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* Add playful fonts */
    @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Quicksand:wght@400;600&display=swap');

    /* Update basic styles for more kid-friendly look */
    body {
        background: linear-gradient(135deg, #f3f0ff 0%, #fff5f9 100%);
        font-family: 'Nunito', "Segoe UI", Tahoma, sans-serif;
        margin: 0;
        padding: 0;
        color: #333;
        font-size: 1.1rem;
        line-height: 1.5;
    }

    h1, h2, h3 {
        font-family: 'Baloo 2', cursive;
        margin-bottom: 0.5rem;
        color: #472e9c;
    }

    h1 {
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: 0.02em;
    }

    h2 {
        font-size: 2rem;
        font-weight: 600;
    }

    h3 {
        font-size: 1.5rem;
        font-weight: 600;
    }

    h4 {
        font-family: 'Baloo 2', cursive;
        margin: 0.5rem 0 0.3rem 0;
        color: #5e4aa8;
        font-size: 1.3rem;
        font-weight: 600;
    }

    /* Add progress indicator */
    .progress-bar {
        background: #fff;
        border-radius: 20px;
        padding: 4px;
        margin: 1rem auto;
        max-width: 300px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .progress-fill {
        background: linear-gradient(90deg, #7e61d4, #FF69B4);
        height: 15px;
        border-radius: 20px;
        transition: width 0.5s ease;
        position: relative;
    }

    .progress-label {
        text-align: center;
        font-size: 0.9rem;
        color: #472e9c;
        margin-top: 0.3rem;
    }

    /* Update card styles for more playful look */
    .card {
        background: white;
        border-radius: 25px;
        padding: 2.5rem;
        box-shadow: 0 8px 20px rgba(126, 97, 212, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 3px solid transparent;
        position: relative;
    }

    .card::before {
        content: '‚ú®';
        position: absolute;
        top: -15px;
        right: -15px;
        font-size: 2rem;
        transform: rotate(20deg);
    }

    /* Add encouraging messages */
    .encouragement {
        background: #fff;
        border-radius: 15px;
        padding: 1rem;
        margin: 1rem 0;
        text-align: center;
        font-size: 1.1rem;
        color: #472e9c;
        border: 2px dashed #7e61d4;
        display: none;
    }

    .encouragement.visible {
        display: block;
        animation: bounce 0.5s ease;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    /* Update stakeholder icons with more kid-friendly emojis */
    .stakeholder-label {
        font-family: 'Baloo 2', cursive;
        font-weight: 600;
        font-size: 1.2rem;
    }

    .stakeholder-label[data-role="emp"]::before { content: 'üë©‚Äçüç≥ '; }
    .stakeholder-label[data-role="cust"]::before { content: 'üßí '; }
    .stakeholder-label[data-role="comp"]::before { content: 'üè™ '; }

    /* Add step indicators */
    .step-indicator {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin: 1rem 0;
    }

    .step {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #fff;
        border: 2px solid #7e61d4;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #7e61d4;
    }

    .step.active {
        background: #7e61d4;
        color: #fff;
    }

    .step.complete::after {
        content: '‚úì';
        color: #2e8b57;
    }

    /* Update feedback messages to be more encouraging */
    .feedback-message.correct {
        background: #e8f5e9;
        padding: 0.8rem;
        border-radius: 10px;
        border-left: 4px solid #2e8b57;
    }

    .feedback-message.incorrect {
        background: #fff3f3;
        padding: 0.8rem;
        border-radius: 10px;
        border-left: 4px solid #dc3545;
    }

    /* ----- Basic Page & Colors ----- */
    p {
      line-height: 1.4em;
      margin-bottom: 0.5rem;
    }
    
    /* Centered container for "Choose Adventure" screen */
    #choose-adventure {
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
      padding: 2rem 1rem;
    }
    #choose-adventure h1 {
      margin-bottom: 1rem;
    }
    .adventure-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2.5rem;
      padding: 3rem;
      position: relative;
    }
    .adventure-cards::before {
      content: '‚ú¶';
      position: absolute;
      top: -20px;
      left: 10%;
      font-size: 2rem;
      color: #7e61d4;
      animation: float 3s ease-in-out infinite;
    }
    .adventure-cards::after {
      content: '‚úß';
      position: absolute;
      bottom: -20px;
      right: 10%;
      font-size: 2rem;
      color: #FF69B4;
      animation: float 3s ease-in-out infinite 1s;
    }
    .card:hover:not(.locked) {
      transform: translateY(-10px) scale(1.02);
      border-color: #7e61d4;
    }
    .card:hover:not(.locked)::before {
      opacity: 0.1;
    }
    .card h2 {
      color: #472e9c;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      position: relative;
      display: inline-block;
      font-family: 'Baloo 2', cursive;
      font-weight: 600;
    }
    .card h2::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 3px;
      background: linear-gradient(90deg, #7e61d4, #FF69B4);
      transition: width 0.3s ease;
    }
    .card:hover:not(.locked) h2::after {
      width: 100%;
    }
    .card p {
      color: #666;
      font-size: 1.1rem;
      line-height: 1.5;
      margin-bottom: 2rem;
      font-family: 'Nunito', sans-serif;
    }
    .card button {
      background: linear-gradient(45deg, #7e61d4, #6f53be);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 25px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      font-family: 'Nunito', sans-serif;
      font-weight: 600;
    }
    .card button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    .card button:hover:not([disabled])::before {
      width: 300px;
      height: 300px;
    }
    .card.locked {
      background: #f8f4ff;
      opacity: 0.9;
    }
    .card.locked button {
      background: #e0e0e0;
      cursor: not-allowed;
    }
    .card.locked button {
      background: #e0e0e0;
      cursor: not-allowed;
    }

    /* Add styles for the retry button and score display */
    .retry-button {
        background: #7e61d4;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 0.8rem 1.5rem;
        margin-top: 1rem;
        cursor: pointer;
        font-size: 1rem;
        transition: background-color 0.2s;
        display: block;
        margin: 1rem auto;
    }

    .retry-button:hover {
        background: #6f53be;
    }



    /* Update complete button styles */
    #complete-ice-cream, #complete-library, #complete-themepark {
        display: none;
        margin: 2rem auto;
        padding: 1rem 2rem;
        font-size: 1.2rem;
        background: linear-gradient(45deg, #7e61d4, #FF69B4);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    #complete-ice-cream:disabled, #complete-library:disabled, #complete-themepark:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    /* ----- Scenario Container & Content ----- */
    .container {
      max-width: 900px;
      margin: 1rem auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem 1.5rem;
      display: none; /* hidden until shown */
    }
    /* Reusable button style in scenarios */
    button {
      background: #7e61d4;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s ease;
      margin-top: 0.5rem;
      font-family: 'Nunito', sans-serif;
      font-weight: 600;
    }
    button:hover {
      background: #6f53be;
    }
    
    /* ----- "Choose 3 changes" clickable tiles ----- */
    .change-list {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .change-option {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.8rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .change-option:hover {
      background: #f2f2f2;
    }
    .change-option.selected {
      background: #e6e0f7;
      border-color: #7e61d4;
    }
    /* When changes are locked, the selection area won't respond to clicks */
    .change-option.locked {
      cursor: default;
    }
    /* Each change's stakeholder sliders will appear below the change text.
       They remain hidden until confirmed. */
    .stakeholder-sliders-for-change {
      margin-top: 1rem;
      display: none;
    }

    /* Update stakeholder label styles to prevent overlapping */
    .stakeholder-block {
        background: #faf7ff;
        border: 1px solid #dccff7;
        border-radius: 6px;
        padding: 0.8rem;
        margin-bottom: 0.8rem;
    }

    .stakeholder-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #472e9c;
    }

    .slider-container {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        position: relative;
    }

    .stakeholder-block input[type="range"] {
        flex: 1;
        margin: 0;
    }

    .emotion-display {
        font-family: 'Baloo 2', cursive;
        font-weight: 600;
        color: #472e9c;
        min-width: 100px;
        text-align: right;
    }

    /* ----- Freedoms Placeholders ----- */
    .experiment-area, .fail-area, .express-area, .share-area {
      margin: 1rem 0;
      padding: 0.8rem;
      border-radius: 6px;
    }
    .experiment-area {
      background: #fff8de;
      border: 1px dashed #f0c000;
    }
    .fail-area {
      background: #ffeef0;
      border: 1px dashed #ec4141;
    }
    .express-area {
      background: #e6f7ff;
      border: 1px dashed #00aaff;
    }
    .share-area {
      background: #e9ffef;
      border: 1px dashed #6be872;
    }
    .simulation-result {
      background: #eef2ff;
      border-left: 4px solid #7e61d4;
      margin-top: 0.7rem;
      padding: 0.6rem;
      border-radius: 4px;
      display: none;
    }

    /* ----- Reflection / Discussion Containers ----- */
    #reflection, #discussion-prep {
      background: #faf7ff;
      border: 1px solid #dccff7;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: none;
    }
    textarea {
      width: 100%;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
    }

    /* Add feedback message styling */
    .feedback-message {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        min-height: 1.5em;
        padding: 0.5rem;
        border-radius: 4px;
        transition: all 0.3s ease;
        font-family: 'Nunito', sans-serif;
    }
    .feedback-message.correct {
        color: #2e8b57;
    }
    .feedback-message.incorrect {
        color: #dc3545;
    }

    /* Add dissolve animation for unselected changes */
    @keyframes dissolveOut {
        0% { 
            opacity: 1; 
            transform: scale(1);
        }
        100% { 
            opacity: 0;
            transform: scale(0.8);
        }
    }
    .change-option.dissolving {
        animation: dissolveOut 0.8s ease-out forwards;
        pointer-events: none;
    }

    /* Lock button styles */
    .check-prediction-btn.locked {
        background: #808080;
        cursor: not-allowed;
    }

    /* Hide express and share sections */
    .express-area, .share-area {
        display: none;
    }

    /* Remove experiment tab */
    .experiment-area {
        display: none;
    }

    /* Confetti styles */
    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: #f00;
        clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%);
        animation: fall 3s ease-out forwards;
        z-index: 1000;
    }
    @keyframes fall {
        0% {
            transform: translateY(-100vh) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
        }
    }

    .change-feedback {
        background: #f8f4ff;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }
    .change-feedback h4 {
        color: #472e9c;
        margin: 0 0 0.5rem 0;
    }
    .change-feedback p {
        margin: 0.5rem 0;
        padding: 0.5rem;
        border-radius: 4px;
    }
    .change-feedback p.correct {
        background: #e8f5e9;
        color: #2e7d32;
    }
    .change-feedback p.incorrect {
        background: #ffebee;
        color: #c62828;
    }

    input[type="range"]:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
    
    .check-prediction-btn.locked {
        background-color: #ccc;
        cursor: not-allowed;
    }
    
    .stakeholder-block.locked .slider-container {
        opacity: 0.7;
        pointer-events: none;
    }
  </style>
</head>
<body>

  <!-- "Choose Your Adventure" Intro Screen -->
  <div id="choose-adventure">
    <h1>Choose Your Adventure <span>ü§π</span></h1>
    <p>Select an adventure to begin your emotional intelligence journey!</p>
    <div class="adventure-cards">
      <!-- Ice Cream Shop Adventure -->
      <div class="card" id="card-icecream">
        <h2>Ice Cream Shop</h2>
        <p>Experience different perspectives in a busy ice cream shop!</p>
        <button onclick="startIceCream()">Start This Adventure</button>
      </div>
      <!-- Library Learning Center (locked at first) -->
      <div class="card locked" id="card-library">
        <h2>Library Learning Center</h2>
        <p>Complete the Ice Cream Shop adventure first to unlock this!</p>
        <button onclick="startLibrary()" disabled>Locked üîí</button>
      </div>
      <div class="card locked" id="card-themepark">
        <h2>Theme Park Adventure</h2>
        <p>Complete the Library adventure first to unlock this!</p>
        <button onclick="startThemePark()" disabled>Locked üîí</button>
      </div>
    </div>
  </div>

  <!-- SCENARIO 1: ICE CREAM STORE -->
  <div class="container" id="ice-scenario">
    <h2>Scenario: Ice Cream Shop</h2>
    <p>Start by selecting <strong>3 changes</strong> from the options below.</p>
    
    <!-- Each change option includes its own stakeholder reactions.
         Note: The stakeholder slider panels remain hidden until confirmation. -->
    <h4>Choose 3 changes for your Ice Cream Store</h4>
    <ul class="change-list" id="changeList">
      <!-- Change Option 1 -->
      <li class="change-option" 
          onclick="toggleChange(this, 'Add new exotic flavors like &quot;Dragon Fruit Delight&quot; and &quot;Chocolate Volcano&quot;')" 
          data-emp="1" data-cust="0" data-comp="7">
        <div class="change-text">
          Add new exotic flavors like "Dragon Fruit Delight" and "Chocolate Volcano"
        </div>
        <div class="stakeholder-sliders-for-change">
          <div class="stakeholder-block">
            <span class="stakeholder-label">üë®‚Äçüíº Employees</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="1" data-role="emp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòÑ Excited</span>
            </div>
            <button class="check-prediction-btn" style="display: none;" 
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üßë‚Äçü§ù‚Äçüßë Customers</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="0" data-role="cust"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòä Happy</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üè™ Competitors</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="7" data-role="comp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üò† Annoyed</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
        </div>
      </li>
      
      <!-- Change Option 2 -->
      <li class="change-option" 
          onclick="toggleChange(this, 'Raise prices by 20% to use premium ingredients')" 
          data-emp="4" data-cust="6" data-comp="2">
        <div class="change-text">
          Raise prices by 20% to use premium ingredients
        </div>
        <div class="stakeholder-sliders-for-change">
          <div class="stakeholder-block">
            <span class="stakeholder-label">üë®‚Äçüíº Employees</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="4" data-role="emp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòê Neutral</span>
            </div>
            <button class="check-prediction-btn" style="display: none;" 
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üßë‚Äçü§ù‚Äçüßë Customers</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="6" data-role="cust"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòü Upset</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üè™ Competitors</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="2" data-role="comp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòé Proud</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
        </div>
      </li>
      
      <!-- Change Option 3 -->
      <li class="change-option" 
          onclick="toggleChange(this, 'Create a mobile ice cream truck service')" 
          data-emp="1" data-cust="1" data-comp="7">
        <div class="change-text">
          Create a mobile ice cream truck service
        </div>
        <div class="stakeholder-sliders-for-change">
          <div class="stakeholder-block">
            <span class="stakeholder-label">üë®‚Äçüíº Employees</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="1" data-role="emp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòÑ Excited</span>
            </div>
            <button class="check-prediction-btn" style="display: none;" 
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üßë‚Äçü§ù‚Äçüßë Customers</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="1" data-role="cust"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòÑ Excited</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üè™ Competitors</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="7" data-role="comp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üò† Annoyed</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
        </div>
      </li>
      
      <!-- Change Option 4 -->
      <li class="change-option" 
          onclick="toggleChange(this, 'Replace some staff with self-serve machines')" 
          data-emp="6" data-cust="4" data-comp="0">
        <div class="change-text">
          Replace some staff with self-serve machines
        </div>
        <div class="stakeholder-sliders-for-change">
          <div class="stakeholder-block">
            <span class="stakeholder-label">üë®‚Äçüíº Employees</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="6" data-role="emp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòü Upset</span>
            </div>
            <button class="check-prediction-btn" style="display: none;" 
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üßë‚Äçü§ù‚Äçüßë Customers</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="4" data-role="cust"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòê Neutral</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üè™ Competitors</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="0" data-role="comp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòä Happy</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
        </div>
      </li>
      
      <!-- Change Option 5 -->
      <li class="change-option" 
          onclick="toggleChange(this, 'Start a loyalty program with digital points')" 
          data-emp="4" data-cust="0" data-comp="5">
        <div class="change-text">
          Start a loyalty program with digital points
        </div>
        <div class="stakeholder-sliders-for-change">
          <div class="stakeholder-block">
            <span class="stakeholder-label">üë®‚Äçüíº Employees</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="4" data-role="emp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòê Neutral</span>
            </div>
            <button class="check-prediction-btn" style="display: none;" 
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üßë‚Äçü§ù‚Äçüßë Customers</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="0" data-role="cust"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòä Happy</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
          <div class="stakeholder-block">
            <span class="stakeholder-label">üè™ Competitors</span>
            <div class="slider-container">
              <input type="range" min="0" max="9" value="5" data-role="comp"
                     oninput="showCheckButton(this)" />
              <span class="emotion-display">üòï Confused</span>
            </div>
            <button class="check-prediction-btn" style="display: none;"
                    onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                This is what I think! ü§î
            </button>
            <div class="feedback-message"></div>
          </div>
        </div>
      </li>
    </ul>
    <div class="button-group" style="display: flex; gap: 1rem; justify-content: center; margin: 2rem 0;">
        <button id="confirmBtn" onclick="confirmVChanges()" disabled>
            Confirm Selections
        </button>
        <button id="completeBtn" onclick="checkAllPredictions()" style="display: none;">
            Complete & Get Feedback
        </button>
    </div>

    <div class="score-summary" style="display: none; margin: 2rem 0; padding: 1rem; background: #f8f4ff; border-radius: 8px;">
        <h3 style="text-align: center; color: #472e9c;">Your Understanding Score</h3>
        <div id="score-details"></div>
    </div>
    
    <!-- New completion button, initially disabled -->
    <button id="complete-ice-cream" onclick="completeIceCream()" disabled style="display: block; margin: 2rem auto; padding: 1rem 2rem; font-size: 1.2rem;">
        Complete Ice Cream Adventure
    </button>
  </div>

  <!-- SCENARIO 2: LIBRARY LEARNING CENTER -->
  <div class="container" id="library-scenario">
    <h2>Scenario: Library Learning Center</h2>
    <p>Start by selecting <strong>3 changes</strong> from the options below.</p>
    
    <h4>Choose 3 changes for your Library</h4>
    <ul class="change-list" id="libraryChangeList">
        <!-- Change Option 1 -->
        <li class="change-option" 
            onclick="toggleChange(this, 'Add quiet study pods with noise-canceling features')" 
            data-emp="1" data-cust="0" data-comp="5">
            <div class="change-text">
                Add quiet study pods with noise-canceling features
            </div>
            <div class="stakeholder-sliders-for-change">
                <div class="stakeholder-block">
                    <span class="stakeholder-label">üë©‚Äçüíº Librarians</span>
                    <div class="slider-container">
                        <input type="range" min="0" max="9" value="1" data-role="emp"
                               oninput="showCheckButton(this)" />
                        <span class="emotion-display">üòÑ Excited</span>
                    </div>
                    <button class="check-prediction-btn" style="display: none;" 
                            onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                        This is what I think! ü§î
                    </button>
                    <div class="feedback-message"></div>
                </div>
                <div class="stakeholder-block">
                    <span class="stakeholder-label">üìö Students</span>
                    <div class="slider-container">
                        <input type="range" min="0" max="9" value="0" data-role="cust"
                               oninput="showCheckButton(this)" />
                        <span class="emotion-display">üòä Happy</span>
                    </div>
                    <button class="check-prediction-btn" style="display: none;"
                            onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                        This is what I think! ü§î
                    </button>
                    <div class="feedback-message"></div>
                </div>
                <div class="stakeholder-block">
                    <span class="stakeholder-label">üèõÔ∏è Other Libraries</span>
                    <div class="slider-container">
                        <input type="range" min="0" max="9" value="5" data-role="comp"
                               oninput="showCheckButton(this)" />
                        <span class="emotion-display">üòï Confused</span>
                    </div>
                    <button class="check-prediction-btn" style="display: none;"
                            onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
                        This is what I think! ü§î
                    </button>
                    <div class="feedback-message"></div>
                </div>
            </div>
        </li>

        <!-- Change Option 2 -->
        <li class="change-option" 
            onclick="toggleChange(this, 'Create a digital learning lab with VR equipment')" 
            data-emp="4" data-cust="1" data-comp="7">
            <div class="change-text">
                Create a digital learning lab with VR equipment
            </div>
            <div class="stakeholder-sliders-for-change">
                <!-- Same stakeholder block structure as above -->
            </div>
        </li>

        <!-- Change Option 3 -->
        <li class="change-option" 
            onclick="toggleChange(this, 'Start weekend reading clubs with snacks')" 
            data-emp="2" data-cust="0" data-comp="4">
            <div class="change-text">
                Start weekend reading clubs with snacks
            </div>
            <div class="stakeholder-sliders-for-change">
                <!-- Same stakeholder block structure as above -->
            </div>
        </li>

        <!-- Change Option 4 -->
        <li class="change-option" 
            onclick="toggleChange(this, 'Add a caf√© area with charging stations')" 
            data-emp="6" data-cust="1" data-comp="5">
            <div class="change-text">
                Add a caf√© area with charging stations
            </div>
            <div class="stakeholder-sliders-for-change">
                <!-- Same stakeholder block structure as above -->
            </div>
        </li>

        <!-- Change Option 5 -->
        <li class="change-option" 
            onclick="toggleChange(this, 'Create outdoor reading gardens')" 
            data-emp="2" data-cust="0" data-comp="3">
            <div class="change-text">
                Create outdoor reading gardens
            </div>
            <div class="stakeholder-sliders-for-change">
                <!-- Same stakeholder block structure as above -->
            </div>
        </li>
    </ul>

    <div class="button-group" style="display: flex; gap: 1rem; justify-content: center; margin: 2rem 0;">
        <button id="libraryConfirmBtn" onclick="confirmLibraryChanges()" disabled>
            Confirm Selections
        </button>
        <button id="libraryCompleteBtn" onclick="checkAllLibraryPredictions()" style="display: none;">
            Complete & Get Feedback
        </button>
    </div>

    <div class="score-summary" style="display: none; margin: 2rem 0; padding: 1rem; background: #f8f4ff; border-radius: 8px;">
        <h3 style="text-align: center; color: #472e9c;">Your Understanding Score</h3>
        <div id="library-score-details"></div>
    </div>
    
    <!-- New completion button, initially disabled -->
    <button id="complete-library" onclick="completeLibrary()" disabled style="display: block; margin: 2rem auto; padding: 1rem 2rem; font-size: 1.2rem;">
        Complete Library Adventure
    </button>
  </div>

  <!-- Add Theme Park scenario HTML structure -->
  <div id="themepark-scenario" class="scenario" style="display: none;">
    <h1>Scenario: Theme Park</h1>
    <p>Start by selecting <strong>3 changes</strong> from the options below.</p>
    
    <div class="changes-container">
      <div class="change-option" onclick="selectChange(this)">
        <div class="change-text">Add Virtual Reality Rides</div>
        <div class="stakeholder-sliders-for-change" style="display: none;"></div>
      </div>
      <div class="change-option" onclick="selectChange(this)">
        <div class="change-text">Introduce Season Passes</div>
        <div class="stakeholder-sliders-for-change" style="display: none;"></div>
      </div>
      <div class="change-option" onclick="selectChange(this)">
        <div class="change-text">Add Water Park Section</div>
        <div class="stakeholder-sliders-for-change" style="display: none;"></div>
      </div>
      <div class="change-option" onclick="selectChange(this)">
        <div class="change-text">Nighttime Light Shows</div>
        <div class="stakeholder-sliders-for-change" style="display: none;"></div>
      </div>
      <div class="change-option" onclick="selectChange(this)">
        <div class="change-text">Healthy Food Options</div>
        <div class="stakeholder-sliders-for-change" style="display: none;"></div>
      </div>
    </div>

    <div class="button-group">
      <button id="themepark-confirm-btn" onclick="confirmThemeParkChanges()" disabled>
        Confirm Selections
      </button>
      <button id="themepark-complete-btn" onclick="checkAllThemeParkPredictions()" style="display: none;">
        Complete & Get Feedback
      </button>
    </div>

    <div class="score-summary" style="display: none;">
      <h3>Your Understanding Score</h3>
      <div id="themepark-score-details"></div>
    </div>
  </div>

  <!-- Add stakeholder slider template for both scenarios -->
  <template id="stakeholder-slider-template">
    <div class="stakeholder-block">
        <span class="stakeholder-label">üë• [Stakeholder]</span>
        <div class="slider-container">
            <input type="range" min="0" max="9" value="0" data-role="[role]"
                   oninput="showCheckButton(this)" />
            <span class="emotion-display">üòä Happy</span>
        </div>
        <button class="check-prediction-btn" style="display: none;"
                onclick="checkPrediction(this.previousElementSibling.querySelector('input'))">
            This is what I think! ü§î
        </button>
        <div class="feedback-message"></div>
    </div>
  </template>

  <script>
    // =========================
    // EMOJI SLIDER LOGIC
    // =========================
    const emotionNames = [
      "Happy", "Excited", "Proud", "Relieved", "Neutral",
      "Confused", "Upset", "Annoyed", "Angry", "Embarrassed"
    ];
    const emotionEmojis = [
      "üòä", "üòÑ", "üòé", "üòå", "üòê",
      "üòï", "üòü", "üò†", "üò°", "üò≥"
    ];
    function updateEmotion(slider, labelElOrId) {
      const value = parseInt(slider.value);
      let labelEl;
      if (typeof labelElOrId === 'string') {
        labelEl = document.getElementById(labelElOrId);
      } else {
        labelEl = labelElOrId;
      }
      if (labelEl) {
        labelEl.textContent = emotionEmojis[value] + " " + emotionNames[value];
      }
    }

    // =========================
    // ICE CREAM SCORING LOGIC
    // =========================
    
    // Update the checkPrediction function
    function checkPrediction(slider) {
        if (slider.disabled) return;  // Don't proceed if slider is already disabled

        const stakeholderBlock = slider.closest('.stakeholder-block');
        const checkButton = stakeholderBlock.querySelector('.check-prediction-btn');
        if (checkButton.classList.contains('locked')) return;

        const changeOption = slider.closest('.change-option');
        if (!changeOption || !changeOption.classList.contains('selected')) return;
        
        const changeText = changeOption.querySelector('.change-text').textContent.trim();
        const role = slider.dataset.role;
        const value = parseInt(slider.value);
        const feedbackDiv = stakeholderBlock.querySelector('.feedback-message');

        let isCorrect = false;
        for (let [key, emotions] of Object.entries(changeEmotions)) {
            if (changeText.includes(key)) {
                const correctValue = emotions[role].value;
                if (value === correctValue) {
                    feedbackDiv.textContent = "‚úÖ " + emotions[role].correct;
                    feedbackDiv.className = 'feedback-message correct';
                    currentScore++;
                    isCorrect = true;
                    createConfetti(true);
                } else {
                    feedbackDiv.textContent = "‚ùå " + emotions[role].incorrect;
                    feedbackDiv.className = 'feedback-message incorrect';
                }
                totalAttempts++;
                break;
            }
        }

        // Lock the prediction by disabling both slider and button
        slider.disabled = true;  // Disable the slider
        checkButton.disabled = true;  // Disable the button
        checkButton.classList.add('locked');
        checkButton.style.display = 'none';  // Hide the button
        
        // Add visual indication that the slider is locked
        slider.style.opacity = '0.7';
        slider.style.cursor = 'not-allowed';
        
        // Update fail/learn section
        updateFailLearnSection(changeText, role, isCorrect, value);

        // If all predictions are made, enable complete button
        if (areAllPredictionsMade()) {
            checkAllPredictions();
        }
    }

    // Update the score display function
    function updateScoreDisplay() {
        let scoreDiv = document.querySelector('.score-display');
        if (!scoreDiv) {
            scoreDiv = document.createElement('div');
            scoreDiv.className = 'score-display';
            const iceScenario = document.getElementById('ice-scenario');
            const completeButton = document.getElementById('complete-ice-cream');
            if (iceScenario && completeButton) {
                iceScenario.insertBefore(scoreDiv, completeButton);
            }
        }
        
        const percentage = Math.round((currentScore / totalAttempts) * 100) || 0;
        scoreDiv.textContent = `Score: ${currentScore} / ${totalAttempts} (${percentage}%)`;
    }

    // Update checkAllPredictions function
    function checkAllPredictions() {
        let totalCorrect = currentScore;
        let totalPredictions = 9; // 3 changes √ó 3 stakeholders = 9 total predictions
        
        const percentage = Math.round((totalCorrect / totalPredictions) * 100);

        // Show score summary
        const scoreSummary = document.querySelector('.score-summary');
        if (scoreSummary) {
            scoreSummary.style.display = 'block';
        }

        const scoreDetails = document.getElementById('score-details');
        if (scoreDetails) {
            scoreDetails.innerHTML = `
                <div style="text-align: center; margin-bottom: 1rem;">
                    <h2 style="color: #472e9c; margin: 0;">${percentage}%</h2>
                    <p>You got ${totalCorrect} out of ${totalPredictions} predictions correct!</p>
                    ${percentage >= 70 ? 
                        '<p style="color: #2e8b57;">üåü Great job! You can now complete this adventure!</p>' : 
                        '<p style="color: #dc3545;">Try again to get at least 70% to continue!</p>'}
                </div>
            `;

            // Add retry button if score is too low
            if (percentage < 70) {
                const retryButton = document.createElement('button');
                retryButton.className = 'retry-button';
                retryButton.textContent = 'Try Again üîÑ';
                retryButton.onclick = () => retryScenario('ice-scenario');
                scoreDetails.appendChild(retryButton);
            }

            // Update complete button state
            const completeButton = document.getElementById('complete-ice-cream');
            if (completeButton) {
                completeButton.style.display = 'block';
                completeButton.disabled = percentage < 70;
            }
        }

        return percentage;
    }

    // =========================
    // START/ERROR NAVIGATION
    // =========================
    function showErrorMessage() {
      document.getElementById('choose-adventure').style.display = 'none';
      document.getElementById('error-message').style.display = 'block';
    }
    function backToAdventures() {
      document.getElementById('error-message').style.display = 'none';
      document.getElementById('choose-adventure').style.display = 'block';
    }

    // =========================
    // ICE CREAM: CHANGES WITH STAKEHOLDER REACTIONS
    // =========================
    let selectedChanges = [];

    // Initialize all scenario functions
    function startIceCream() {
        selectedChanges = [];
        currentScore = 0;
        totalAttempts = 0;
        
        document.getElementById('choose-adventure').style.display = 'none';
        document.getElementById('ice-scenario').style.display = 'block';
        
        // Reset UI elements
        resetScenario('ice-scenario');
    }

    // Toggle change selection.
    // The stakeholder slider panels remain hidden until confirmation.
    function toggleChange(element, changeValue) {
      if (element.dataset.locked === "true") return;  // Do not allow changes if locked
      
      if (selectedChanges.includes(changeValue)) {
        // Unselect this change
        selectedChanges = selectedChanges.filter(ch => ch !== changeValue);
        element.classList.remove('selected');
      } else {
        // Limit to 3 selections
        if (selectedChanges.length >= 3) {
          alert("You can only select 3 changes.");
          return;
        }
        selectedChanges.push(changeValue);
        element.classList.add('selected');
      }
      // Enable Confirm button only if exactly 3 changes are selected
      document.getElementById('confirmBtn').disabled = (selectedChanges.length !== 3);
    }

    // Predefined emotions and feedback for ALL changes
    const changeEmotions = {
        'Add new exotic flavors': {
            emp: {
                value: 1,
                correct: "Employees are excited about learning to make new flavors!",
                incorrect: "Think about how employees might feel about creating new and interesting products."
            },
            cust: {
                value: 0,
                correct: "Customers are happy to try exciting new flavors!",
                incorrect: "Consider how customers typically react to new and unique options."
            },
            comp: {
                value: 7,
                correct: "Competitors are annoyed because they might lose customers to these unique flavors.",
                incorrect: "Think about how competing businesses feel when someone offers something they don't have."
            }
        },
        'Raise prices': {
            emp: {
                value: 4,
                correct: "Employees feel neutral as it doesn't directly affect them.",
                incorrect: "Consider how price changes might affect employee tips and customer interactions."
            },
            cust: {
                value: 6,
                correct: "Customers are upset about paying more, even for better quality.",
                incorrect: "Think about how people typically react to price increases."
            },
            comp: {
                value: 2,
                correct: "Competitors are proud because they can advertise lower prices.",
                incorrect: "Consider how competing businesses benefit from having lower prices."
            }
        },
        'Create a mobile ice cream': {
            emp: {
                value: 1,
                correct: "Employees are excited about the new mobile experience!",
                incorrect: "Think about how employees might feel about a new way to serve customers."
            },
            cust: {
                value: 1,
                correct: "Customers are excited about getting ice cream closer to home!",
                incorrect: "Consider how customers feel about easier access to ice cream."
            },
            comp: {
                value: 7,
                correct: "Competitors are annoyed about losing local customers.",
                incorrect: "Think about how competitors feel when you expand into their territory."
            }
        },
        'Replace some staff': {
            emp: {
                value: 6,
                correct: "Employees are upset about potential job losses.",
                incorrect: "Consider how employees feel about automation replacing jobs."
            },
            cust: {
                value: 4,
                correct: "Customers feel neutral about self-service options.",
                incorrect: "Think about how customers react to self-service versus personal service."
            },
            comp: {
                value: 0,
                correct: "Competitors are happy they can advertise their personal service.",
                incorrect: "Consider how competitors might use this change in their favor."
            }
        },
        'Start a loyalty program': {
            emp: {
                value: 4,
                correct: "Employees feel neutral about managing a new system.",
                incorrect: "Think about how employees feel about learning a new process."
            },
            cust: {
                value: 0,
                correct: "Customers are happy about earning rewards!",
                incorrect: "Consider how customers feel about getting free ice cream."
            },
            comp: {
                value: 5,
                correct: "Competitors are confused about whether to copy the program.",
                incorrect: "Think about how competitors react to customer loyalty programs."
            }
        }
    };

    let currentScore = 0;
    let totalAttempts = 0;

    // Update the showCheckButton function to ensure button is enabled when slider changes
    function showCheckButton(slider) {
        if (slider.disabled) return;  // Don't show button if slider is locked
        
        const stakeholderBlock = slider.closest('.stakeholder-block');
        const checkButton = stakeholderBlock.querySelector('.check-prediction-btn');
        const feedbackMessage = stakeholderBlock.querySelector('.feedback-message');
        
        // Update emotion display
        updateEmotion(slider, slider.nextElementSibling);
        
        // Show and enable check button if not already locked
        if (!checkButton.classList.contains('locked')) {
            checkButton.style.display = 'block';
            checkButton.disabled = false;
        }
        
        // Clear previous feedback
        feedbackMessage.textContent = '';
        feedbackMessage.className = 'feedback-message';
    }

    function areAllPredictionsMade() {
        const selectedChangesElems = document.querySelectorAll('.change-option.selected');
        let allChecked = true;
        selectedChangesElems.forEach(change => {
            const sliders = change.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                if (!slider.disabled) {
                    allChecked = false;
                }
            });
        });
        return allChecked;
    }

    // Update the updateFailLearnSection function
    function updateFailLearnSection(changeText, role, isCorrect, value) {
        const failArea = document.querySelector('.fail-area');
        if (!failArea) return;

        let stakeholderName = role === 'emp' ? 'Employees' : 
                             role === 'cust' ? 'Customers' : 'Competitors';
        
        let correctEmotion = null;
        let userEmotion = emotionNames[value];
        
        for (let [key, emotions] of Object.entries(changeEmotions)) {
            if (changeText.includes(key)) {
                correctEmotion = emotionNames[emotions[role].value];
                break;
            }
        }

        if (isCorrect) {
            failArea.innerHTML = `
                <h4>Great Understanding! üåü</h4>
                <p>You correctly predicted that ${stakeholderName} would feel ${correctEmotion} about this change.</p>
                <p>This shows great empathy and business thinking!</p>
            `;
        } else {
            failArea.innerHTML = `
                <h4>Learning Opportunity! ü§î</h4>
                <p>You thought ${stakeholderName} would feel ${userEmotion}, but they might actually feel ${correctEmotion}.</p>
                <p>Think about:</p>
                <ul>
                    <li>How does this change affect their daily routine?</li>
                    <li>What are their main priorities?</li>
                    <li>How might this impact their success/satisfaction?</li>
                </ul>
            `;
        }
    }

    function simulateIceCream() {
        const resultEl = document.getElementById("ice-sim-result");
        if (selectedChanges.length < 3) {
            resultEl.textContent = "Please select 3 changes before testing.";
        } else {
            const {score, maxScore} = checkEmotions();
            let message = `Score: ${score}/${maxScore} correct emotions!\n\n`;
            message += "Keep adjusting the emotion sliders to match how each group might really feel!";
            resultEl.textContent = message;
        }
        resultEl.style.display = "block";
    }

    function completeIceCream() {
        localStorage.setItem('iceCreamCompleted', 'true');
        initializeScenarios();
        // Return to adventure selection
        document.getElementById('ice-scenario').style.display = 'none';
        document.getElementById('choose-adventure').style.display = 'block';
    }

    // Confirm the changes.
    // This will lock the selected changes and then reveal their stakeholder slider panels.
    function confirmVChanges() {
        if (selectedChanges.length !== 3) {
            alert("Please select exactly 3 changes.");
            return;
        }

        // First hide unselected options with animation
        document.querySelectorAll('.change-option').forEach(item => {
            if (!item.classList.contains('selected')) {
                item.classList.add('dissolving');
                setTimeout(() => {
                    item.style.display = 'none';
                }, 800);
            } else {
                // Show the slider container for selected changes
                let sliderContainer = item.querySelector('.stakeholder-sliders-for-change');
                if (sliderContainer) {
                    sliderContainer.style.display = 'block';
                    
                    // Randomize and enable sliders
                    sliderContainer.querySelectorAll('input[type="range"]').forEach(slider => {
                        slider.value = randomizeSliderValue();
                        slider.disabled = false;
                        // Update the emotion display for the random value
                        updateEmotion(slider, slider.nextElementSibling);
                    });
                    
                    sliderContainer.querySelectorAll('.check-prediction-btn').forEach(btn => {
                        btn.style.display = 'block';
                        btn.classList.remove('locked');
                    });
                }
            }
        });

        // Hide confirm button and show complete button
        document.getElementById('confirmBtn').style.display = 'none';
    }

    // =========================
    // LIBRARY SCENARIO
    // =========================
    // Initialize all scenario functions
    function startLibrary() {
        selectedChanges = [];
        currentScore = 0;
        totalAttempts = 0;
        
        document.getElementById('choose-adventure').style.display = 'none';
        document.getElementById('library-scenario').style.display = 'block';
        
        // Reset UI elements
        resetScenario('library-scenario');
    }

    function confirmLibraryChanges() {
        if (selectedChanges.length !== 3) {
            alert("Please select exactly 3 changes.");
            return;
        }

        // First hide unselected options with animation
        document.querySelectorAll('#library-scenario .change-option').forEach(item => {
            if (!item.classList.contains('selected')) {
                item.classList.add('dissolving');
                setTimeout(() => {
                    item.style.display = 'none';
                }, 800);
            } else {
                // Show the slider container for selected changes
                let sliderContainer = item.querySelector('.stakeholder-sliders-for-change');
                if (sliderContainer) {
                    sliderContainer.style.display = 'block';
                    
                    // Randomize and enable sliders
                    sliderContainer.querySelectorAll('input[type="range"]').forEach(slider => {
                        slider.value = randomizeSliderValue();
                        slider.disabled = false;
                        // Update the emotion display for the random value
                        updateEmotion(slider, slider.nextElementSibling);
                    });
                    
                    sliderContainer.querySelectorAll('.check-prediction-btn').forEach(btn => {
                        btn.style.display = 'block';
                        btn.classList.remove('locked');
                    });
                }
            }
        });

        // Hide confirm button
        document.getElementById('libraryConfirmBtn').style.display = 'none';
    }

    function simulateLibrary() {
      const c1 = document.getElementById("lib-change1").value.trim();
      const c2 = document.getElementById("lib-change2").value.trim();
      const c3 = document.getElementById("lib-change3").value.trim();
      const resultEl = document.getElementById("lib-sim-result");

      if(!c1 && !c2 && !c3) {
        resultEl.textContent = "No changes added yet!";
      } else {
        resultEl.textContent = "Your Library ideas could help librarians and patrons, while the community may welcome new services. Keep refining your approach!";
      }
      resultEl.style.display = "block";
    }

    // =========================
    // RESET SCENARIOS
    // =========================
    function resetScenario(containerId) {
      const container = document.getElementById(containerId);

      // Reset text inputs
      container.querySelectorAll('input[type="text"]').forEach(input => input.value = '');

      // For the ice cream scenario, unselect change tiles and hide their stakeholder panels
      if (containerId === 'ice-scenario') {
        selectedChanges = [];
        const tiles = container.querySelectorAll('.change-option');
        tiles.forEach(t => {
          t.classList.remove('selected', 'locked', 'dissolving');
          delete t.dataset.locked;
          let sliderContainer = t.querySelector('.stakeholder-sliders-for-change');
          if (sliderContainer) {
            sliderContainer.style.display = 'none';
          }
        });
        document.getElementById('confirmBtn').disabled = true;
        document.getElementById('complete-ice-cream').disabled = true;
      }

      // Reset all sliders (both in library and ice cream scenarios)
      container.querySelectorAll('input[type="range"]').forEach(slider => {
        slider.value = 0;
        if (slider.nextElementSibling && slider.nextElementSibling.classList.contains('emotion-display')) {
          slider.nextElementSibling.textContent = emotionEmojis[0] + " " + emotionNames[0];
        }
      });

      // Hide any simulation results
      container.querySelectorAll('.simulation-result').forEach(div => {
        div.style.display = 'none';
        div.textContent = '';
      });

      // Reset check buttons
      const checkButtons = document.querySelectorAll('.check-prediction-btn');
      checkButtons.forEach(button => {
        button.style.display = 'none';
        button.classList.remove('checked');
        button.textContent = 'This is what I think! ü§î';
      });
    }

    // Function to check predictions for Library scenario
    function checkAllLibraryPredictions() {
        let totalCorrect = 0;
        let totalPossible = 0;
        let feedbackHtml = '';

        document.querySelectorAll('#library-scenario .change-option.selected').forEach(changeOption => {
            const changeText = changeOption.querySelector('.change-text').textContent.trim();
            const sliders = changeOption.querySelectorAll('input[type="range"]');
            
            feedbackHtml += `<div class="change-feedback">
                <h4>${changeText}</h4>`;

            sliders.forEach(slider => {
                const role = slider.dataset.role;
                const value = parseInt(slider.value);
                
                for (let [key, emotions] of Object.entries(changeEmotions)) {
                    if (changeText.includes(key)) {
                        const correctValue = emotions[role].value;
                        totalPossible++;
                        
                        let stakeholderName = role === 'emp' ? 'Employees' : 
                                            role === 'cust' ? 'Customers' : 'Competitors';
                        
                        if (value === correctValue) {
                            totalCorrect++;
                            feedbackHtml += `<p class="correct">‚úÖ ${stakeholderName}: ${emotions[role].correct}</p>`;
                            createConfetti(true);
                        } else {
                            feedbackHtml += `<p class="incorrect">‚ùå ${stakeholderName}: ${emotions[role].incorrect}</p>`;
                        }
                        break;
                    }
                }
            });
            
            feedbackHtml += '</div>';
        });

        showScoreSummary('library', totalCorrect, totalPossible, feedbackHtml);
    }

    // Function to check predictions for Theme Park scenario
    function checkAllThemeParkPredictions() {
        let totalCorrect = 0;
        let totalPossible = 0;
        let feedbackHtml = '';

        document.querySelectorAll('#themepark-scenario .change-option.selected').forEach(changeOption => {
            const changeText = changeOption.querySelector('.change-text').textContent.trim();
            const sliders = changeOption.querySelectorAll('input[type="range"]');
            
            feedbackHtml += `<div class="change-feedback">
                <h4>${changeText}</h4>`;

            sliders.forEach(slider => {
                const role = slider.dataset.role;
                const value = parseInt(slider.value);
                
                for (let [key, emotions] of Object.entries(changeEmotions)) {
                    if (changeText.includes(key)) {
                        const correctValue = emotions[role].value;
                        totalPossible++;
                        
                        let stakeholderName = role === 'emp' ? 'Employees' : 
                                            role === 'cust' ? 'Visitors' : 'Competitors';
                        
                        if (value === correctValue) {
                            totalCorrect++;
                            feedbackHtml += `<p class="correct">‚úÖ ${stakeholderName}: ${emotions[role].correct}</p>`;
                            createConfetti(true);
                        } else {
                            feedbackHtml += `<p class="incorrect">‚ùå ${stakeholderName}: ${emotions[role].incorrect}</p>`;
                        }
                        break;
                    }
                }
            });
            
            feedbackHtml += '</div>';
        });

        showScoreSummary('themepark', totalCorrect, totalPossible, feedbackHtml);
    }

    // Function to show score summary and handle progression
    function showScoreSummary(scenarioType, totalCorrect, totalPossible, feedbackHtml) {
        const percentage = Math.round((totalCorrect / totalPossible) * 100);
        const scenarioElement = document.getElementById(`${scenarioType}-scenario`);
        const scoreSummary = scenarioElement.querySelector('.score-summary');
        const scoreDetails = document.getElementById(`${scenarioType}-score-details`);
        
        scoreSummary.style.display = 'block';
        scoreDetails.innerHTML = `
            <div class="score-header">
                <h2>${percentage}%</h2>
                ${percentage >= 70 ? 
                    '<p style="color: #2e8b57;">üåü Great job! You can now complete this adventure!</p>' : 
                    '<p style="color: #dc3545;">Try again to get at least 70% to continue!</p>'}
            </div>
            <div class="feedback-details">
                ${feedbackHtml}
            </div>
        `;

        // Add retry button if score is too low
        if (percentage < 70) {
            const retryButton = document.createElement('button');
            retryButton.className = 'retry-button';
            retryButton.textContent = 'Try Again üîÑ';
            retryButton.onclick = () => retryScenario(scenarioType);
            scoreDetails.appendChild(retryButton);
        }

        // Disable all sliders and buttons
        scenarioElement.querySelectorAll('input[type="range"]').forEach(slider => {
            slider.disabled = true;
        });
        scenarioElement.querySelector(`#${scenarioType}-complete-btn`).disabled = true;

        if (percentage >= 70) {
            if (scenarioType === 'ice-scenario') {
                completeIceCream();
            } else if (scenarioType === 'library-scenario') {
                completeLibrary();
            } else if (scenarioType === 'themepark-scenario') {
                alert(`Congratulations! You've completed all scenarios with ${percentage}%!`);
                document.getElementById('themepark-scenario').style.display = 'none';
                document.getElementById('choose-adventure').style.display = 'block';
            }
        } else {
            alert(`Try again to get at least 70% to continue!`);
        }
    }

    function completeLibrary() {
        localStorage.setItem('libraryCompleted', 'true');
        initializeScenarios();
        // Return to adventure selection
        document.getElementById('library-scenario').style.display = 'none';
        document.getElementById('choose-adventure').style.display = 'block';
    }

    function unlockNextScenario(currentScenario) {
        if (currentScenario === 'icecream') {
            const libraryCard = document.getElementById('card-library');
            libraryCard.classList.remove('locked');
            const libButton = libraryCard.querySelector('button');
            libButton.disabled = false;
            libButton.onclick = startLibrary;
        } else if (currentScenario === 'library') {
            const themeparkCard = document.getElementById('card-themepark');
            themeparkCard.classList.remove('locked');
            const parkButton = themeparkCard.querySelector('button');
            parkButton.disabled = false;
            parkButton.textContent = "Start This Adventure";
            parkButton.onclick = startThemePark;
        }
    }

    // Function to initialize scenarios and handle unlocking
    function initializeScenarios() {
        // Get completion status from localStorage (or set to false if not exists)
        const iceCreamCompleted = localStorage.getItem('iceCreamCompleted') === 'true';
        const libraryCompleted = localStorage.getItem('libraryCompleted') === 'true';
        
        // Update UI based on completion status
        if (iceCreamCompleted) {
            // Unlock Library scenario
            const libraryCard = document.getElementById('card-library');
            if (libraryCard) {
                libraryCard.classList.remove('locked');
                const button = libraryCard.querySelector('button');
                if (button) {
                    button.disabled = false;
                    button.textContent = 'Start This Adventure';
                }
            }
        }
        
        if (libraryCompleted) {
            // Unlock Theme Park scenario
            const themeParkCard = document.getElementById('card-themepark');
            if (themeParkCard) {
                themeParkCard.classList.remove('locked');
                const button = themeParkCard.querySelector('button');
                if (button) {
                    button.disabled = false;
                    button.textContent = 'Start This Adventure';
                }
            }
        }
    }

    // Initialize scenarios when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        initializeScenarios();
    });

    // Reset function for any scenario
    function resetScenario(scenarioId) {
        const scenario = document.getElementById(scenarioId);
        if (!scenario) return;
        
        // Reset all change options
        scenario.querySelectorAll('.change-option').forEach(option => {
            option.classList.remove('selected', 'locked', 'dissolving');
            option.style.display = 'block';
            delete option.dataset.locked;
            
            const sliderContainer = option.querySelector('.stakeholder-sliders-for-change');
            if (sliderContainer) {
                sliderContainer.style.display = 'none';
            }
        });

        // Reset buttons
        const confirmBtn = scenario.querySelector(`#${scenarioId}-confirm-btn`);
        if (confirmBtn) {
            confirmBtn.disabled = true;
            confirmBtn.style.display = 'block';
        }

        const completeBtn = scenario.querySelector(`#${scenarioId}-complete-btn`);
        if (completeBtn) {
            completeBtn.style.display = 'none';
        }

        // Reset score summary
        const scoreSummary = scenario.querySelector('.score-summary');
        if (scoreSummary) {
            scoreSummary.style.display = 'none';
        }
    }

    function completeThemePark() {
        localStorage.setItem('themeParkCompleted', 'true');
        initializeScenarios();
        // Return to adventure selection
        document.getElementById('themepark-scenario').style.display = 'none';
        document.getElementById('choose-adventure').style.display = 'block';
    }

    function startThemePark() {
        selectedChanges = [];
        currentScore = 0;
        totalAttempts = 0;
        
        document.getElementById('choose-adventure').style.display = 'none';
        document.getElementById('themepark-scenario').style.display = 'block';
        
        // Reset UI elements
        resetScenario('themepark-scenario');
    }

    function addRetryButton(scenarioType, scoreDetails) {
        const retryButton = document.createElement('button');
        retryButton.className = 'retry-button';
        retryButton.textContent = 'Try Again';
        retryButton.onclick = () => retryScenario(scenarioType);
        scoreDetails.appendChild(retryButton);
    }

    function retryScenario(scenarioId) {
        // Reset scores and selections
        selectedChanges = [];
        currentScore = 0;
        totalAttempts = 0;

        const scenario = document.getElementById(scenarioId);
        
        // Reset all change options
        scenario.querySelectorAll('.change-option').forEach(option => {
            // Remove all special classes
            option.classList.remove('selected', 'locked', 'dissolving');
            // Show all options again
            option.style.display = 'block';
            // Remove any locked state
            delete option.dataset.locked;
            
            // Reset stakeholder sliders container
            const sliderContainer = option.querySelector('.stakeholder-sliders-for-change');
            if (sliderContainer) {
                sliderContainer.style.display = 'none';
                
                // Reset all sliders within
                sliderContainer.querySelectorAll('input[type="range"]').forEach(slider => {
                    slider.disabled = false;
                    slider.value = randomizeSliderValue(); // Randomize initial slider value
                    delete slider.dataset.scored;
                    updateEmotion(slider, slider.nextElementSibling);
                });

                // Reset all check buttons
                sliderContainer.querySelectorAll('.check-prediction-btn').forEach(button => {
                    button.classList.remove('locked');
                    button.textContent = 'This is what I think! ü§î';
                    button.style.display = 'none';
                });

                // Clear all feedback messages
                sliderContainer.querySelectorAll('.feedback-message').forEach(msg => {
                    msg.textContent = '';
                    msg.className = 'feedback-message';
                });
            }
        });

        // Reset buttons
        const confirmBtn = document.getElementById('confirmBtn');
        if (confirmBtn) {
            confirmBtn.style.display = 'block';
            confirmBtn.disabled = true;
        }

        const completeBtn = document.getElementById('completeBtn');
        if (completeBtn) {
            completeBtn.style.display = 'none';
        }

        // Reset score display
        const scoreDisplay = scenario.querySelector('.score-display');
        if (scoreDisplay) {
            scoreDisplay.textContent = '';
        }

        // Hide score summary
        const scoreSummary = scenario.querySelector('.score-summary');
        if (scoreSummary) {
            scoreSummary.style.display = 'none';
        }

        // Reset fail/learn section
        const failArea = scenario.querySelector('.fail-area');
        if (failArea) {
            failArea.innerHTML = `
                <h4>Fail & Learn</h4>
                <p>It's okay if an idea doesn't work. Mistakes help us learn!</p>
            `;
        }

        // Reset complete button
        const completeScenarioBtn = document.getElementById(`complete-${scenarioId}`);
        if (completeScenarioBtn) {
            completeScenarioBtn.style.display = 'none';
            completeScenarioBtn.disabled = true;
        }

        // Scroll to top of scenario
        scenario.scrollIntoView({ behavior: 'smooth' });
    }

    // Add this new function to generate random slider values
    function randomizeSliderValue() {
        return Math.floor(Math.random() * 10); // Returns a random number between 0-9
    }

    // Add this function before the other functions
    function createConfetti(isCorrect) {
        if (!isCorrect) return;
        
        for (let i = 0; i < 30; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            
            // Random colors for confetti
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // Random starting position
            confetti.style.left = Math.random() * 100 + 'vw';
            
            // Random rotation
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            
            // Random size
            const size = Math.random() * 10 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;
            
            // Add to body
            document.body.appendChild(confetti);
            
            // Remove after animation
            setTimeout(() => {
                confetti.remove();
            }, 3000);
        }
    }
  </script>
</body>
</html>
